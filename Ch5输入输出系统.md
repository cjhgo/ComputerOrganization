viewport:width=device-width,initial-scale=1

目录

[TOC]
#[计算机组成原理](...)
##Ch3输入输出系统
重点分析i/o设备和主机交换信息的三种控制方式
(实际上还有两种,在体系结构中介绍)

###1.概述

####输入输出系统发展的4个阶段
1. 早期阶段
2. 接口模块和DMA模块
	- 接口中设有数据通路和控制通路;
	数据通路:可以缓存数据,完成串并转换;控制通路用以传送cpu和i/o设备之间的命令
		+ 使用接口实现主机和i/o设备交换信息时cpu要中断
	- DMA,在i/o设备和主存之间有一条直接数据通路,cpu不用中断
3. 具有通道结构的阶段
4. 具有i/o处理机的阶段

####输入输出系统的组成
**输入输出系统由I/O软件和I/O硬件两部分组成**

+ I/O指令
+ 通道指令
####I/O设备与主机的联系方式

1. I/O设备编址方式
	+ 独立编址
	+ 统一编址
2. 设备寻址
	+ 通过接口电路中的设备选择电路选中要交换信息的设备
3. 传送方式
	+ 并行:速度快,要求较多数据线
	+ 串行:速度慢,适合远距离传送
4. 联络方式
	+ 立即响应,无须特殊的联络信号,指令一道立即响应,,,,,,????
	+ 异步工作,采用应答信号联络
	+ 同步工作,采用同步时标联络
5. 连接方式
	+ 总线式
	+ 辐射式
####I/O设备与主机信息传送的控制方式

1. 程序查询
2. 程序中断
3. 直接存储器存取方式(DMA)
4. I/O通道方式
5. I/O处理机方式
(1,2,3详见后边,4,5不具体讲述)

###2.I/O设备
,,,,,,,,,,??????????/
###3.I/O接口
,,,,,,,,,,?????????
###4.程序查询方式
核心问题:**每时每刻不断查询I/O设备是否准备就绪**

####程序查询流程
+ 单个I/O设备的查询流程
	+ 程序流程
		1. 由于传送数据需要占用cpu的寄存器,所以**保护寄存器**内容
		2. 由于传送的往往是一批数据,所以**设置计数值**
		3. 设置欲传送数据的首地址
		4. cpu启动i/o设备
		5. 进入程序查询流程:
			- test:准备就绪,?
				+ 就绪:数据传送
				+ 未就绪:接着test
		6. 完成一次数据传送后,修改主存地址,修改计数值,
		7. 判断计数值,看传送是否完毕
		8. 结束i/o传送
+ 多个I/O设备的查询流程:
	- 按设备在系统中的优先级别进行逐级查询

为完成查询,通常需要3条指令

+ 测试指令
+ 传送指令
+ 转移指令

####程序查询方式的接口电路

+ 输出$\quad cpu\rightarrow i/o接口 \rightarrow i/o设备$
+ 输入$\quad cpu\leftarrow i/o接口 \leftarrow i/o设备$
l

###5.程序中断方式
**主要介绍i/o中断处理的相关内容**

####程序中断方式的接口电路

1. 中断请求触发器和中断屏蔽触发器
	- 每台外设设置一个中断请求触发器INTR,为1时,表示设备箱cpu提出中断请求
		+ 设备要想提出中断请求,本身必须准备就绪,所以设置一个完成触发器D,表示设备的状态
		+ 当多个中断源同时向CPU提出中断请求时,CPU要坚持一个原则,任何瞬间只能接受一个中断源的请求
		所以每个i/o接口需设置一个屏蔽触发器MASK,当其为1时,表示被屏蔽
		+ cpu在统一的时间-每条指令执行阶段的最后时刻-查询所有设备是否有中断请求
			- (只针对外中断,是这个时刻,内中断肯定要及时响应)
		+ 综上:cpu的中断查询信号将中断请求触发器置1的条件
		(也就是说,外设提出中断,未必会被满足,cpu不一定能将中断请求出发器置1,
		也就是说,中断请求触发器置1,不是说外设提出了中断,而是说cpu满足中断请求)
			+ 设备就绪,即完成触发器为1
			+ 没有被屏蔽,
![接口发出中断请求的条件][0]		
[0]:http://cjhgo.sinaapp.com/CS/ComputerOrganization/images/INTR.gif
解读:在<u>设备就绪</u>且<u>没有被屏蔽</u>的情况下,当cpu的中断查询信号传来时,接口发出了中断请求信号
(这个信号输出到排队器里边去,参与排队)
2. 排队器:多个中断源同时提出请求时,按优先级高低给予响应,**速度越高优先级越高**
(因为如果不及时响应速度高的设备,它的信息可能会立即消失)
优先权处理可用硬件方法,软件方法,
	+ 软件方法:编写程序查询
	+ 硬件方法:硬件排队器(链式排队器)
		- 在cpu内部设置一个统一的排队器
		![补图][图8.25]
		- 在接口电路内分别设置各个设备的排队器
		![分设的链式排队器][2]
[2]:http://cjhgo.sinaapp.com/CS/ComputerOrganization/images/chainqueue.gif
3. 中断向量地址形成部件(设备编码器)
响应中断就要去执行对应的中断服务程序.cpu如何找到中断服务程序的入口地址,?
	+ 软件查询法:
	+ 硬件向量法:通过向量地址来寻找中断服务程序的入口地址,
	**而向量地址是由硬件电路产生**
		+ 对应于链式排队器的两种放法,中断向量地址形成部件也有两种放法
			- 分散设置在各个接口电路中
			- 放置在cpu内部
		+ 由向量地址寻找中断服务程序入口地址通常也采用两种放法
			- 向量地址内存存放一条无条件转义指令,向量地址送PC
			- 向量地址内存存放入口地址(**设置向量地址表**),访存得打入口地址
			**区别在于一个放的是指令,一个放的是地址**
	+ 分清**向量地址**和中断服务程序入口地址**的区别
4. 电路图
![补图][图5.41]
####i/o中断处理过程
中断请求,中断判优
###6.DMA方式