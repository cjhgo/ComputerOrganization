viewport:width=device-width,initial-scale=1

目录

[TOC]

#[计算机组成原理](...)
##Ch8CPU的结构和功能
+ 机器完成一条指令的全过程
+ 为了进一步提高数据的处理能力,开发系统的并行性所采取的的流水技术
###CPU的结构
####CPU的功能
+ 指令控制:控制程序的顺序执行
+ 操作控制:产生完成每条指令所需的控制命令
+ 时间控制:对各种操作加以时间上的控制
+ 数据加工:对数据进行算术运算和逻辑运算
+ 处理中断
####CPU结构框图
+ ALU
+ CU
+ 寄存器
+ 中断系统
####CPU的寄存器
#####用户可见寄存器
cpu执行机器语言访问的寄存器
按特征

+ 通用寄存器
+ 数据寄存器
+ 地址寄存器
+ 条件码寄存器,对用户来说部分透明
条件码是CPU根据运算结构由硬件设置的位
	+ 条件码可被测试
	+ 部分条件码可被置位与复位

在调用子程序前,必须将所有用户可见寄存器的内容保存起来
这种保存可由CPU自动完成,也可以由程序员编程保存
#####控制和状态寄存器
被控制部件使用,以控制CPU的操作,也可被带有特权的操作系统程序使用

+ MAR
+ MDR
+ PC
+ IR
#####控制单元
提供完成全部指令操作的微操作命令序列
现代计算机中微操作命令序列形成有两种

+ 组合逻辑
+ 存储逻辑
###指令周期
指令周期:CPU每取出并执行一条指令所需的全部时间
取指阶段,执行阶段
####指令周期的基本概念
+ 取指周期FE:访存取指令
+ 间址周期IND:访存取有效地址
+ 执行周期EX:访存取操作数(当这是一条访存指令时)
+ 中断周期INT:保存程序断点
将程序断点保存到存储器的特殊地址处
	- 在执行周期后边

指令

标志触发器
####指令周期的数据流
+ 取指周期,
	- 控制部件CU向存储器发读命令
+ 间址周期,
	- 一旦取指周期结束,CU便检查IR中的内容,确定其是否有间址操作
+ 执行周期,数据流不一而足
+ 中断周期	
###指令流水
+ 为了提高访存速度
	- 提高存储芯片的性能
	- 在体系结构上采用多体,cache等分级存储措施
+ 为了提高主机和I/O交换信息的速度
	- DMA
	- 多总线
+ 为了提高运算速度
	- 采用高速芯片和快速进位链
	- 改进算法
+ 为了进一步提高处理机速度
	- 提高器件性能
		+ 电子管,晶体管,集成电路,大规模集成电路四代计算机
	- 改进系统结构,开发系统的并行性
####指令流水原理
将指令的处理过程细分为几个阶段

+ 取指FI
+ 指令译码DI
+ 计算操作数地址CO
+ 取操作数FO
+ 执行指令EI
+ 写操作数WO
####影响流水线性能的因素
讨论5级流水线,IF,ID,EX,MEM,WB
#####结构相关(资源相关)冲突
指令重叠执行过程中,不同指令争用同一功能部件产生资源冲突

例如第i条指令的IF和第j条指令的MEM都要访存,而存储器只有一个访问口
这就产生了结果相关/资源相关
解决方法

+ 暂停第i条指令的IF操作
+ 设置两个独立的存储器分别存放操作数和指令
+ 指令预取,,,
#####数据相关冲突
指令重叠执行过程中,后继指令需要用到前面指令的执行结果
改变了对操作数的读写访问顺序,导致了数据相关冲突

由于指令重叠,本来在后的指令提前执行

+ 各种数据相关,根据指令间对同一寄存器读和写操作的先后次序
`RAW,WAR,WAW,这些名字给出的是非流水线的正常执行顺序`
`A是after,!!!,RAW,read after write,写(然)后读,WR`
	- $RAW,read \quad after \quad write,读(然)后写\\\
	:本来应该先W后R,流水线中成了先R后W了$
	- $WAR,write \quad after \quad read,读(然)后写\\\
	:前边的指令还没读,后边的指令就写了,使前边的指令读错了$
	- $WAWwrite \quad after \quad write,写(然)后写\\\
	:写的顺序颠倒了$

在按序流动的流水线中只有可能出现RAW
在非按序流动的流水线中,
**由于允许后进入流水线的指令超过先进入流水线的指令而先流出流水线**
RAW,WAR,WAW都有可能发生

+ 解决方法
	- 后推法:将相关指令延迟到所需操作数被写回到寄存器后再执行
	- 定向技术/旁路技术/相关专用通路技术:
	不必 等待某条指令的执行结果送回到寄存器再从寄存器中取出,作为下一条指令的源操作数
	而是 直接将执行结果送到其他指令需要的地方
#####控制相关
控制相关由转移指令引起
转移发生时,流水线的连续流动收到破坏

尽早判别转移是否发生;
尽早生成转移目标地址;
预取转移成功或不成功两个控制流方向上的指令;
加快和提前形成条件码;
提高转移方向的猜准率;
####流水线性能
1. 吞吐率:单位时间内流水线完成指令或输出结果的数量
	+ 最大吞吐率,流水线稳定后,每隔一段($\Delta t$),就输出一条流水线
	$对于m段的流水线而言,若各段的时间均为\Delta t,则最大吞吐率为\\\
	T_{pmax}= \frac{1}{\Delta t}$
	+ 实际吞吐率:完成n条指令的实际吞吐率,流水线刚建立时,尚未稳定,不能达到最大吞吐率
	$m段的指令流水线,各段时间均为\Delta t,连续处理n条指令\\\
	第一条需要m\cdot \Delta t,其余(n-1)条指令,每隔\Delta t就输出一个,\\\
	共计m\cdot \Delta t+(n-1)\Delta t\\\
	故,实际吞吐率为T_p= \frac{n}{m\cdot \Delta t+(n-1)\Delta t} = \frac{T_{pmax}}{1+(m-1)/n}$	
2. 加速比:m段流水线的速度与等功能非流水线速度之比
$完成n条指令,非流水线需要时间为nm\Delta t,流水线用的时间为m\cdot \Delta t+(n-1)\Delta t\\\
故加速比S_p= \frac{nm\Delta t}{m\cdot \Delta t+(n-1)\Delta t} = \frac{m}{1+(m-1)/n}$
3. 效率:流水线中各功能段的利用率
流水线有建立时间与排空时间,各功能段的设备不可能一直处于工作状态

流水线的时空图

[0]:http://cjhgo.sinaapp.com/CS/ComputerOrganization/images/efficiency.gif